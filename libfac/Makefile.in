# $Id: Makefile.in,v 1.1.1.1 1997-05-02 17:00:43 Singular Exp $
#################################################
SHELL		= /bin/sh
RM		= -rm -f
#################################################
TARGETNAME		= @targetname@
LIBFACVERSION		= @libfacversion@
LIBFACNAME		= @libfac@
SINGLIBFACNAME		= @libsingfac@
LIBFACNAME-G		= @libfac_g@
SINGLIBFACNAME-G	= @libsingfac_g@
LIBFACINCLUDE		= @factorH@
#################################################
## 
## various paths
##
srcdir		= @srcdir@
prefix 		= @prefix@
exec_prefix	= @exec_prefix@
libdir 		= @libdir@
includedir	= @includedir@

## 
## various programs
##
AR		= @AR@ cr
RANLIB		= @RANLIB@
CXX		= @CXX@
INSTALL		= @INSTALL@
INSTALL_DATA	= @INSTALL_DATA@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
MKINSTALLDIRS	= @MKINSTALLDIRS@

##
## compiler and linker options
##
CXXFLAGS	= @CXXFLAGS@
CXXTEMPLFLAGS	= @CXXTEMPLFLAGS@
CPPFLAGS	= @CPPFLAGS@ -I${srcdir}
DEFS		= @DEFS@ 
LDFLAGS		= @LDFLAGS@
LIBS		= @LIBS@

##
## src and objects
##

FACTORSRC1 =	factor/SqrFree.cc factor/Factor.cc \
		factor/MVMultiHensel.cc factor/Truefactor.cc \
		factor/helpstuff.cc  factor/debug.cc factor/version.cc \
		factor/homogfactor.cc
FACTORSRC2 =	factor/tmpl_inst.cc
FACTORSRC = 	$(FACTORSRC2) $(FACTORSRC1)

CHARSETSRC1 =	charset/csutil.cc charset/charset.cc charset/reorder.cc
CHARSETSRC = 	$(CHARSETSRC1)

FACTORINCL =	factor/Factor.h factor/MVMultiHensel.h factor/Truefactor.h \
		factor/tmpl_inst.h factor/SqrFree.h factor/helpstuff.h \
		factor/debug.h factor/timing.h factor/homogfactor.h
CHARSETINCL =	charset/csutil.h charset/charset.h charset/reorder.h

OPTFACTOROBJ1 =	OPTOBJ/SqrFree.o OPTOBJ/Factor.o OPTOBJ/MVMultiHensel.o \
		OPTOBJ/Truefactor.o OPTOBJ/helpstuff.o OPTOBJ/version.o \
		OPTOBJ/homogfactor.o
OPTFACTOROBJ2 =	OPTOBJ/tmpl_inst.o
OPTFACTOROBJ =	$(OPTFACTOROBJ2) $(OPTFACTOROBJ1)

OPTCHARSETOBJ =	OPTOBJ/csutil.o OPTOBJ/charset.o OPTOBJ/reorder.o

DEBFACTOROBJ1 =	DEBOBJ/SqrFree.o DEBOBJ/Factor.o DEBOBJ/MVMultiHensel.o \
		DEBOBJ/Truefactor.o DEBOBJ/helpstuff.o DEBOBJ/version.o \
		DEBOBJ/homogfactor.o
DEBFACTOROBJ2 =	DEBOBJ/tmpl_inst.o
DEBFACTOROBJ = 	$(DEBFACTOROBJ2) $(DEBFACTOROBJ1)

DEBCHARSETOBJ =	DEBOBJ/csutil.o DEBOBJ/charset.o DEBOBJ/reorder.o

##
## Primary targets
##

.SUFFIXES:      .cc .h .o

all: ${TARGETNAME}

OPTOBJ/%.o: %.cc 
	$(CXX) $(CXXFLAGS) $(CXXTEMPLFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@

OPTOBJ/%.o: charset/%.cc 
	$(CXX) $(CXXFLAGS) $(CXXTEMPLFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@

OPTOBJ/%.o: factor/%.cc
	$(CXX) $(CXXFLAGS) $(CXXTEMPLFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@

OPTOBJ/tmpl_inst.o: factor/tmpl_inst.cc 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@

DEBOBJ/%.o: %.cc 
	$(CXX) $(CXXFLAGS) $(CXXTEMPLFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@

DEBOBJ/%.o: charset/%.cc 
	$(CXX) $(CXXFLAGS) $(CXXTEMPLFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@

DEBOBJ/%.o: factor/%.cc
	$(CXX) $(CXXFLAGS) $(CXXTEMPLFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@

DEBOBJ/tmpl_inst.o: factor/tmpl_inst.cc 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@


libfac:		libfac.a

libsingfac:	libsingfac.a

libfac-g:	libfac-g.a

libsingfac-g:	libsingfac-g.a

libfac.a:	$(OPTFACTOROBJ) $(OPTCHARSETOBJ)
		$(AR) ${LIBFACNAME}.a $(OPTFACTOROBJ) $(OPTCHARSETOBJ)
		$(RANLIB) ${LIBFACNAME}.a

libsingfac.a:	$(OPTFACTOROBJ1) $(OPTCHARSETOBJ)
		$(AR) ${SINGLIBFACNAME}.a $(OPTFACTOROBJ1) $(OPTCHARSETOBJ)
		$(RANLIB) ${SINGLIBFACNAME}.a

libfac-g.a:	$(DEBFACTOROBJ) $(DEBCHARSETOBJ)
		$(AR) ${LIBFACNAME}.a $(DEBFACTOROBJ) $(DEBCHARSETOBJ)
		$(RANLIB) ${LIBFACNAME}.a

libsingfac-g.a:	$(DEBFACTOROBJ1) $(DEBCHARSETOBJ)
		$(AR) ${SINGLIBFACNAME}.a $(DEBFACTOROBJ1) $(DEBCHARSETOBJ)
		$(RANLIB) ${SINGLIBFACNAME}.a

install:	all
	${MKINSTALLDIRS} ${includedir}
	${MKINSTALLDIRS} ${libdir}
	${INSTALL_DATA} ${LIBFACINCLUDE} ${includedir}
	${INSTALL_PROGRAM} ${TARGETNAME}.a ${libdir}


uninstall: 
	$(RM) ${includedir}/${LIBFACINCLUDE}
	$(RM) ${libdir}/${LIBFACNAME}.a
	$(RM) ${libdir}/${SINGLIBFACNAME}.a

mostlyclean:
	$(RM)	test ${LIBFACNAME}.a ${SINGLIBFACNAME}.a \
		${LIBFACNAME-G}.a ${SINGLIBFACNAME-G}.a

clean:	mostlyclean
	$(RM) charset/DEBOBJ/* OPTOBJ/*
	$(RM) OPTOBJ/optdepend DEBOBJ/debdepend  \
	      DEBOBJ/*.o OPTOBJ/*.o

distclean:	clean
	$(RM) config.cache config.log config.status Makefile

dist:	distclean
	$(RM) ../libfac-${LIBFACVERSION}.tgz
	(cd .. ; gtar -zcvf libfac-${LIBFACVERSION}.tgz libfac-${LIBFACVERSION})

########## From here on: Only for internal use!
#################################################

factest:	libfac OPTOBJ/test.o   
		$(CXX) -o test $(LDFLAGS) OPTOBJ/test.o $(LIBS)

factests:	factest
		(cd tests ; factortest )

tests:		factests

