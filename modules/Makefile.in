#################################################################
###
### Makefile for Singular-modules
###
### $Id: Makefile.in,v 1.3 2000-03-29 14:13:33 krueger Exp $
###
#################################################################

SHELL		= /bin/sh

## 
## various paths
##
topsrcdir	= @top_srcdir@
srcdir		= @srcdir@
prefix 		= @prefix@
exec_prefix 	= @exec_prefix@
libdir 		= @libdir@
# program executable goes here
bindir		= @bindir@
# Singular libs go here
includedir	= @includedir@
MOD_DEST	= ./include
INC_SRC		= $(topsrcdir)/Singular
MODDIRS		= pcv kernel

## 
## various programs
##
CC		= @CC@
CXX		= @CXX@
LEXP		= @LEXP@
PERL		= @PERL@
BISON		= bison
@SET_MAKE@
INSTALL		= ./install-sh -c
INSTALL_PROGRAM	= ${INSTALL}
INSTALL_DATA	= ${INSTALL} -m 644
MKINSTALLDIRS   = ./mkinstalldirs
MODGEN		= ${bindir}/modgen

##
## compiler and linker options
##
CFLAGS		= @CFLAGS@ -pipe -Iinclude -I../Singular
CXXFLAGS	= @CXXFLAGS@ -pipe 
#CXXTEMPLFLAGS	= @CXXTEMPLFLAGS@
CPPFLAGS	= -I${srcdir} @CPPFLAGS@
DEFS		= @DEFS@ -DNDEBUG
LDFLAGS		= @LDFLAGS@ # @LD_DYNAMIC@
#STATIC_LDFLAGS	= @STATIC_LDFLAGS@
#LIBS		= @NEED_LIBS@

##
## End configuration dependend stuff
#################################################################
##
## compiler and linker options
##
CFLAGS		+= ${DEFS}

MOD_INCLUDES	= mod2.h utils.h structs.h mmemory.h tok.h ipid.h \
	subexpr.h febase.h modules.h grammar.h numbers.h polys.h \
	ideals.h intvec.h polys-impl.h lists.h matpol.h ipconv.h \
	lists.h matpol.h mmpage.h mmheap.h

##
##
##

all: mod_install modgen modules

mod_install:
	for file in ${MOD_INCLUDES}; do \
		if test -f ${MOD_DEST}/$${file}; then \
			rm -f ${MOD_DEST}/$${file}; \
		fi; \
		cp ${INC_SRC}/$${file} ${MOD_DEST}/$${file}; \
		chmod 444 ${MOD_DEST}/$${file}; \
	done

modgen:
	cd tools; make install

modules:
	for SUBDIR in ${MODDIRS}; \
	do \
		echo ${MAKE} $@ in $${SUBDIR}; \
		( cd $${SUBDIR} && ${MODGEN} $${SUBDIR}.mod ;); \
		( cd $${SUBDIR} && ${MAKE} ;) \
	done

clean:
	rm -f *.o *.lo *.so* *.la *~ core
	for file in ${MOD_INCLUDES}; do \
		rm -f ${MOD_DEST}/$${file}; \
	done
	( cd tools && make $@; )
	for SUBDIR in ${MODDIRS}; \
	do \
		echo ${MAKE} $@ in $${SUBDIR}; \
		( cd $${SUBDIR} && ${MAKE} $@; ) \
	done

distclean: clean
	( cd tools && make clean )
	for SUBDIR in ${MODDIRS}; \
	do \
		echo ${MAKE} $@ in $${SUBDIR}; \
		( cd $${SUBDIR} && ${MAKE} $@ ;) \
	done
	rm -f Makefile

install: all
	cd tools; make install
	for SUBDIR in ${MODDIRS}; \
	do \
		echo ${MAKE} $@ in $${SUBDIR}; \
		( cd $${SUBDIR} && ${MAKE} $@;) \
	done
