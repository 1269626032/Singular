#####################################################################
### 
### Makefile for emacs stuff
###
#####################################################################
SHELL=/bin/sh

prefix		= @prefix@
docdir		= ${prefix}/doc
SINGULAR	= @SINGULAR@
emacsdir	= ${install_prefix}/emacs

PERL5		= @PERL5@
INSTALL		= ../install-sh -c
INSTALL_DATA	= ${INSTALL} -m 644
MKINSTALLDIRS   = ../mkinstalldirs

SINGULAR_HLP	= ${docdir}/singular.hlp

all install: cmd-cmpl.el hlp-cmpl.el lib-cmpl.el

cmd-cmpl.el: ${SINGULAR} cmpl.pl
	${PERL5} cmpl.pl -Singular ${SINGULAR} -cmpl cmd > cmd-cmpl.el

hlp-cmpl.el: ${SINGULAR_HLP} cmpl.pl
	${PERL5} cmpl.pl -hlp ${SINGULAR_HLP} -cmpl hlp > hlp-cmpl.el

# this is weird, if I work directly with _one_ pipe, 
# then things break from time to time
lib-cmpl.el: ${prefix}/Singular/Makefile cmpl.pl
	${MAKE} --no-print-directory -s -f ${prefix}/Singular/Makefile echoLIBS > lib-temp
	cat lib-temp | ${PERL5} cmpl.pl -cmpl lib > lib-cmpl.el
	rm lib-temp

clean:
	rm cmd-cmpl.el hlp-cmpl.el lib-cmpl.el

install-sharedist: all
	${MKINSTALLDIRS} ${emacsdir}
	${INSTALL_DATA} cmd-cmpl.el ${emacsdir}
	${INSTALL_DATA} lib-cmpl.el ${emacsdir}
	${INSTALL_DATA} hlp-cmpl.el ${emacsdir}
	${INSTALL_DATA} singular.el ${emacsdir}
	${INSTALL_DATA} .emacs-singular ${emacsdir}
	${INSTALL_DATA} sing.xpm	${emacsdir}

