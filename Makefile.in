#################################################################
###
### Top-level Makefile for Singular
###
### The main purpose of this Makefile is to call `make'
### recursively in the subdirectories determined at configuration
### time.
###
#################################################################

@SET_MAKE@
SHELL		= /bin/sh

SINGULAR	= @SINGULAR@

BUILD_SUBDIRS	= @CONFIG_SUBDIRS@
SUBDIRS		= @SUBDIRS@

##############################################################
# default target
${SINGULAR}:
	${MAKE} install

# general targets
# simply descend for these targets
all install uninstall:
	@ for SUBDIR in ${BUILD_SUBDIRS}; \
	do \
	  echo ${MAKE} $@ in $${SUBDIR}; \
	  ( cd $${SUBDIR} && ${MAKE} $@; ) \
	done

##############################################################
# cleaning up

# we use a canned sequence to avoid code redundancy
define recurse
@ for SUBDIR in ${SUBDIRS}; \
do \
  echo ${MAKE} $@ in $${SUBDIR}; \
  ( cd $${SUBDIR} && ${MAKE} $@; ) \
done
endef

local-clean:
	rm -rf *~ a.out core *.o *.log

local-distclean: local-clean
	rm -rf Makefile config.cache config.log config.status TAGS* *.gz *.tar;\

local-maintainer-clean: local-distclean
	@ echo "This command is intended for maintainer use, only"
	rm -rf configure

clean mostlyclean: uninstall local-clean
	$(recurse)

distclean: uninstall local-distclean
	$(recurse)

maintainer-clean: uninstall local-maintainer-clean
	$(recurse)

##############################################################
# some extra targets for the specific packages
Singular factory libfac MP gmp:
	cd $@; ${MAKE} all

##############################################################
# documentation
.PHONY: info dvi ps
info dvi ps doc/singular.hlp:
	cd doc; ${MAKE} $@

.PHONY: doc info/singular.hlp
doc info/singular.hlp:
	cd doc; ${MAKE} install

##############################################################
# Tst targets: DO NOT USE, YET -- THEY ARE STILL BROKEN
Tst-All: Tst-Old Tst-Short Tst-Long

Tst: Tst-Old Tst-Short

Tst-Old: ${SINGULAR} Tst/Old/universal.lst Tst/regress.cmd
	Tst/regress.cmd -s ${SINGULAR} Tst/Old/universal.lst

Tst-Short: ${SINGULAR} Tst/Short Tst/regress.cmd
	Tst/regress.cmd -s ${SINGULAR} Tst/Short/*.tst

Tst-Long:  ${SINGULAR} Tst/Short Tst/regress.cmd
	Tst/regess.cmd -s ${SINGULAR} Tst/Long/*.tst


##############################################################
# stuff for configure
Makefile : Makefile.in config.status
	CONFIG_FILES=Makefile ./config.status

doc/Makefile: doc/Makefile.in config.status
	CONFIG_FILES=doc/Makefile ./config.status

config.status: configure
	./config.status --recheck

configure: configure.in
	@echo "You need to rerun autoconf. I am proceeding, for now."
	@touch configure
# 	autoconf 
#
