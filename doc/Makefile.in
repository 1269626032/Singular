#####################################################################
### 
### Makefile for Singular documentation 
###
#####################################################################
SHELL=/bin/sh

####################################################################
##
## Configuration
##

## directory where info files are installed
prefix		= @prefix@
infodir		= ${prefix}/info

##
## needed programs
##
@SET_MAKE@
CC		= @CC@
INSTALL		= ../install-sh -c
INSTALL_PROGRAM	= ${INSTALL}
INSTALL_DATA	= ${INSTALL} -m 644
MKINSTALLDIRS   = ../mkinstalldirs

TEX		= tex
MAKEINFO	= makeinfo
TEXI2DVI	= texi2dvi
TEXINDEX	= texindex
DVIPS		= dvips

SINGULAR	= @SINGULAR@
##
## End configuration dependend stuff
#################################################################

# files
TEX_FILES	= copyright.tex
DOC2TEX_FILES	= \
		examples.tex general.tex math.tex reference.tex \
		singular.tex start.tex types.tex pdata.tex

MANUAL_FILES	= ${TEX_FILES} ${DOC2TEX_FILES}
TUTOR_FILES	= \
		tutor.tex examples.tex start.tex proc.tex copyright.tex

.PHONY: info dvi ps 
# default target
all: info dvi html

# info stuff
info: singular.hlp 

singular.hlp: ${MANUAL_FILES}
	- ${MAKEINFO} --no-split singular.tex

# dvi stuff
dvi: singular.dvi tutor.dvi usercard.dvi

singular.dvi: ${MANUAL_FILES}
	${TEXI2DVI} singular.tex

tutor.dvi: ${TUTOR_FILES}
	${TEXI2DVI} tutor.tex

usercard.dvi: usercard.tex singcard.tex
	${TEX} $<

# postscript stuff
ps: singular.ps tutor.ps usercard.ps

usercard.ps: usercard.dvi
	${DVIPS} -t landscape $< -o $@

%.ps: %.dvi
	${DVIPS} $< -o $@

# html stuff
html: ${MANUAL_FILES}
	test -d html || mkdir html
	cd html && ../texi2html -I .. -menu -expandinfo -number -split_node -verbose ../singular.tex
	touch html

# how to create the texinfo files
%.tex: %.doc doc2tex ${SINGULAR}
	@ echo
	@ echo "Be sure Singular is up-to-date before making the examples!"
	@ echo
	./doc2tex ${SINGULAR} $*
	- grep "error occurred" $@

doc2tex: doc2tex.c
	$(CC) doc2tex.c -o doc2tex

# targets concerned with maintenance
install: singular.hlp
	${MKINSTALLDIRS} ${infodir}
	${INSTALL_DATA} singular.hlp ${infodir}

uninstall: 
	rm -f ${infodir}/singular.hlp
	- rmdir ${infodir}

clean:
	/bin/rm -f .singular_hist doe.tmp dump.ascii example.mp example.txt
	/bin/rm -f save_i test.ascii test.mp
	/bin/rm -f Z* *.tst *.pag *.dir *.lst *.log *.aux *.cp *.cps
	/bin/rm -f *.fn *.fns *.ky *.kys *.log *.pg *.pgs *.toc *.tp
	/bin/rm -f *.tps *.vr *.vrs
	/bin/rm -f doc2tex singular.hlp *.dvi *.ps ${DOC2TEX_FILES}
	/bin/rm -rf html

mostlyclean: clean

distclean: mostlyclean
	/bin/rm -f Makefile

maintainer-clean: distclean

${SINGULAR}:
#	cd ..; ${MAKE} ${SINGULAR}

Makefile: Makefile.in
	cd ..; ${MAKE} doc/Makefile
